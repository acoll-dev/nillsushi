(function() {
  'use strict';
  angular.module('mainApp').controller('mainCtrl', ["$rootScope", "$scope", "$grRestful", "$grAlert", "$grModal", "$cookies", "$timeout", function($rootScope, $scope, $grRestful, $grAlert, $grModal, $cookies, $timeout) {
    var alert;
    $rootScope.GRIFFO.curYear = (new Date).getFullYear();
    if ($rootScope.GRIFFO.filter.page.blocks) {
      $rootScope.BLOCKS = {};
      angular.forEach($rootScope.GRIFFO.filter.page.blocks, function(block) {
        return $rootScope.BLOCKS[block.name] = block.content;
      });
    }
    alert = $grAlert["new"]();
    $rootScope.logouting = false;
    $rootScope.gr = {};
    $rootScope.gr.website = {
      copyright: 'Copyright © ' + (new Date).getFullYear() + ' - Todos os direitos reservados.'
    };
    $rootScope.gr.contactHeader = [
      {
        title: 'Facebook Acoll',
        link: 'http://fb.com/fan.acoll',
        "class": 'contact fa fa-fw fa-2x fa-facebook-square'
      }, {
        title: 'E-mail Acoll',
        link: 'mailto:contato@acoll.com.br',
        "class": 'contact fa fa-fw fa-2x fa-envelope'
      }
    ];
    $rootScope.gr.shops = [];
    $rootScope.gr.banners = [];
    $grRestful.find({
      module: 'banner',
      action: 'get'
    }).then(function(r) {
      if (r.response) {
        return $rootScope.gr.banners = r.response;
      }
    });
    $grRestful.find({
      module: 'shop',
      action: 'get'
    }).then(function(r) {
      if (r.response) {
        return $rootScope.gr.shops = r.response;
      }
    });
    $rootScope.logout = function() {
      alert.show('loading', 'Saindo...', 0);
      $rootScope.logouting = true;
      return $grRestful.auth({
        action: 'logout'
      }).then(function(r) {
        delete $cookies.griffo_cart_ready;
        if (r.response) {
          alert.show('success', 'Você saiu do sistema e está sendo redirecionado!');
          window.location.reload();
        } else {
          console.debug('Falha no logout!');
        }
        $rootScope.logouting = false;
      }, function(r) {
        return console.debug('Falha no logout!');
      });
    };
    return (function() {
      var init, properties, ready, setProducts, struct;
      init = true;
      ready = {
        categories: false,
        products: false
      };
      setProducts = function() {
        var productLoop;
        productLoop = function(category) {
          category.products = [];
          angular.forEach($scope.products, function(product) {
            if (product.fkidcategory === category.idcategory) {
              product.count = 0;
              category.products.push(product);
              return $rootScope.gr.cart.add(product);
            }
          });
          if (category.child) {
            return angular.forEach(category.child, function(subcategory) {
              return productLoop(subcategory);
            });
          }
        };
        return angular.forEach($scope.categories, function(category) {
          return productLoop(category);
        });
      };
      if ($cookies.griffo_cart) {
        struct = JSON.parse($cookies.griffo_cart)[0];
        properties = ['id', 'name', 'count', 'unitvalue'];
        if (struct) {
          if (!angular.equals(Object.getOwnPropertyNames(struct), properties)) {
            $cookies.griffo_cart = JSON.stringify([]);
          }
        }
      }
      $rootScope.$watch('gr.cart.items', (function(items) {
        var arr;
        arr = [];
        angular.forEach(items, function(i) {
          if (i.count > 0) {
            return arr.push({
              id: i.idproduct || i.id,
              name: i.name,
              count: i.count,
              unitvalue: i.unitvalue
            });
          }
        });
        return $cookies.griffo_cart = JSON.stringify(arr);
      }), true);
      $rootScope.ready = function() {
        if (ready.categories && ready.products) {
          return true;
        } else {
          return false;
        }
      };
      $rootScope.products = [];
      $rootScope.categories = [];
      $rootScope.gr.cart = {
        title: 'Lista do pedido',
        templateUrl: 'cart.html',
        placement: 'bottom',
        animation: false,
        trigger: 'click',
        opened: false,
        items: $cookies.griffo_cart ? JSON.parse($cookies.griffo_cart) : [],
        length: function(total) {
          var l;
          l = 0;
          angular.forEach($rootScope.gr.cart.items, function(item) {
            if (item.count > 0 && !total) {
              l++;
            } else if (total) {
              l += item.count;
            }
          });
          return l;
        },
        check: function(item) {
          var count;
          count = parseInt(item.count);
          if (count > 1000) {
            count = 1000;
          } else if (count < 0) {
            count = 0;
          } else if (!/[0-9]+/.test(count)) {
            count = 0;
          }
          item.count = count;
        },
        clear: function() {
          angular.forEach($rootScope.gr.cart.items, function(item) {
            item.count = 0;
          });
        },
        has: function(item) {
          var found, index;
          found = false;
          index = void 0;
          angular.forEach($rootScope.gr.cart.items, function(i, id) {
            if (i.name === item.name) {
              found = true;
              index = id;
            }
          });
          if (found) {
            return index;
          } else {
            return found;
          }
        },
        remove: function(item) {
          item.count = 0;
        },
        add: function(item) {
          var found;
          found = false;
          angular.forEach($rootScope.gr.cart.items, function(i) {
            if (i.name === item.name) {
              found = true;
            }
          });
          if (!found) {
            item.count = 0;
            $rootScope.gr.cart.items.push(item);
          }
        },
        total: function() {
          var total;
          total = 0;
          angular.forEach($rootScope.gr.cart.items, function(item) {
            total += item.unitvalue * item.count;
          });
          return total;
        },
        submit: function() {
          if ($rootScope.GRIFFO.filter.page.url !== 'finish/') {
            $cookies.griffo_cart_ready = true;
            $timeout(function() {
              location.href = $rootScope.GRIFFO.curAlias + '/finish';
            });
          } else {
            $rootScope.finishForm.submit();
          }
        },
        cancel: function() {
          $grModal.confirm('Tem certeza que deseja cancelar?', function() {
            $rootScope.gr.cart.clear();
            delete $cookies.griffo_cart_ready;
          });
        }
      };
      $grRestful.find({
        module: 'category',
        action: 'module',
        params: 'name=product'
      }).then(function(r) {
        if (r.response) {
          $rootScope.categories = r.response;
          ready.categories = true;
          if ($rootScope.ready) {
            return setProducts();
          }
        }
      });
      $grRestful.find({
        module: 'product',
        action: 'get'
      }).then(function(r) {
        if (r.response) {
          $scope.products = r.response;
          angular.forEach(r.response, function(item) {
            return item.picture = $rootScope.GRIFFO.uploadPath + item.picture;
          });
          ready.products = true;
          if ($rootScope.ready) {
            return setProducts();
          }
        }
      });
      return angular.element('body').on({
        mousedown: function(e) {
          var target;
          target = angular.element(e.target);
          if (target.parents('.cart').length === 0 && $scope.gr.cart.opened) {
            return angular.element('.btn-cart').trigger('click');
          }
        }
      });
    })();
  }]);

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsaWVudC9sYXllcnMvd2Vic2l0ZS90ZW1wbGF0ZXMvY3JhYi9jb2ZmZWUvY29udHJvbGxlcnMvbWFpbkN0cmwuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQUE7RUFDQSxPQUFPLENBQUMsTUFBUixDQUFlLFNBQWYsQ0FBeUIsQ0FBQyxVQUExQixDQUFxQyxVQUFyQyxFQUFpRCxTQUFDLFVBQUQsRUFBYSxNQUFiLEVBQXFCLFVBQXJCLEVBQWlDLFFBQWpDLEVBQTJDLFFBQTNDLEVBQXFELFFBQXJELEVBQStELFFBQS9EO0FBRTdDLFFBQUE7SUFBQSxVQUFVLENBQUMsTUFBTSxDQUFDLE9BQWxCLEdBQTRCLENBQUMsSUFBSSxJQUFMLENBQVUsQ0FBQyxXQUFYLENBQUE7SUFFNUIsSUFBRyxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBakM7TUFDSSxVQUFVLENBQUMsTUFBWCxHQUFvQjtNQUNwQixPQUFPLENBQUMsT0FBUixDQUFnQixVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBOUMsRUFBc0QsU0FBQyxLQUFEO2VBQ2xELFVBQVUsQ0FBQyxNQUFPLENBQUEsS0FBSyxDQUFDLElBQU4sQ0FBbEIsR0FBZ0MsS0FBSyxDQUFDO01BRFksQ0FBdEQsRUFGSjs7SUFNQSxLQUFBLEdBQVEsUUFBUSxDQUFDLEtBQUQsQ0FBUixDQUFBO0lBQ1IsVUFBVSxDQUFDLFNBQVgsR0FBdUI7SUFDdkIsVUFBVSxDQUFDLEVBQVgsR0FBZ0I7SUFDaEIsVUFBVSxDQUFDLEVBQUUsQ0FBQyxPQUFkLEdBQXdCO01BQUEsU0FBQSxFQUFXLGNBQUEsR0FBaUIsQ0FBQyxJQUFJLElBQUwsQ0FBVSxDQUFDLFdBQVgsQ0FBQSxDQUFqQixHQUE0QyxrQ0FBdkQ7O0lBQ3hCLFVBQVUsQ0FBQyxFQUFFLENBQUMsYUFBZCxHQUE4QjtNQUMxQjtRQUNJLEtBQUEsRUFBTyxnQkFEWDtRQUVJLElBQUEsRUFBTSx5QkFGVjtRQUdJLE9BQUEsRUFBTywyQ0FIWDtPQUQwQixFQU0xQjtRQUNJLEtBQUEsRUFBTyxjQURYO1FBRUksSUFBQSxFQUFNLDZCQUZWO1FBR0ksT0FBQSxFQUFPLG9DQUhYO09BTjBCOztJQVk5QixVQUFVLENBQUMsRUFBRSxDQUFDLEtBQWQsR0FBc0I7SUFDdEIsVUFBVSxDQUFDLEVBQUUsQ0FBQyxPQUFkLEdBQXdCO0lBRXhCLFVBQVUsQ0FBQyxJQUFYLENBQ0k7TUFBQSxNQUFBLEVBQVEsUUFBUjtNQUNBLE1BQUEsRUFBUSxLQURSO0tBREosQ0FHQyxDQUFDLElBSEYsQ0FHTyxTQUFDLENBQUQ7TUFDSCxJQUFHLENBQUMsQ0FBQyxRQUFMO2VBQ0ksVUFBVSxDQUFDLEVBQUUsQ0FBQyxPQUFkLEdBQXdCLENBQUMsQ0FBQyxTQUQ5Qjs7SUFERyxDQUhQO0lBT0EsVUFBVSxDQUFDLElBQVgsQ0FDSTtNQUFBLE1BQUEsRUFBUSxNQUFSO01BQ0EsTUFBQSxFQUFRLEtBRFI7S0FESixDQUdDLENBQUMsSUFIRixDQUdPLFNBQUMsQ0FBRDtNQUNILElBQUcsQ0FBQyxDQUFDLFFBQUw7ZUFDSSxVQUFVLENBQUMsRUFBRSxDQUFDLEtBQWQsR0FBc0IsQ0FBQyxDQUFDLFNBRDVCOztJQURHLENBSFA7SUFPQSxVQUFVLENBQUMsTUFBWCxHQUFvQixTQUFBO01BQ2hCLEtBQUssQ0FBQyxJQUFOLENBQVcsU0FBWCxFQUFzQixXQUF0QixFQUFtQyxDQUFuQztNQUNBLFVBQVUsQ0FBQyxTQUFYLEdBQXVCO2FBQ3ZCLFVBQVUsQ0FBQyxJQUFYLENBQ0k7UUFBQSxNQUFBLEVBQVEsUUFBUjtPQURKLENBRUEsQ0FBQyxJQUZELENBRU0sU0FBQyxDQUFEO1FBQ0YsT0FBTyxRQUFRLENBQUM7UUFDaEIsSUFBRyxDQUFDLENBQUMsUUFBTDtVQUNJLEtBQUssQ0FBQyxJQUFOLENBQVcsU0FBWCxFQUFzQixrREFBdEI7VUFDQSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQWhCLENBQUEsRUFGSjtTQUFBLE1BQUE7VUFJSSxPQUFPLENBQUMsS0FBUixDQUFjLGtCQUFkLEVBSko7O1FBS0EsVUFBVSxDQUFDLFNBQVgsR0FBdUI7TUFQckIsQ0FGTixFQVdFLFNBQUMsQ0FBRDtlQUNFLE9BQU8sQ0FBQyxLQUFSLENBQWMsa0JBQWQ7TUFERixDQVhGO0lBSGdCO1dBaUJqQixDQUFBLFNBQUE7QUFDQyxVQUFBO01BQUEsSUFBQSxHQUFPO01BQ1AsS0FBQSxHQUNJO1FBQUEsVUFBQSxFQUFZLEtBQVo7UUFDQSxRQUFBLEVBQVUsS0FEVjs7TUFHSixXQUFBLEdBQWMsU0FBQTtBQUNWLFlBQUE7UUFBQSxXQUFBLEdBQWMsU0FBQyxRQUFEO1VBQ1YsUUFBUSxDQUFDLFFBQVQsR0FBb0I7VUFDcEIsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsTUFBTSxDQUFDLFFBQXZCLEVBQWlDLFNBQUMsT0FBRDtZQUM3QixJQUFHLE9BQU8sQ0FBQyxZQUFSLEtBQXdCLFFBQVEsQ0FBQyxVQUFwQztjQUNJLE9BQU8sQ0FBQyxLQUFSLEdBQWdCO2NBQ2hCLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBbEIsQ0FBdUIsT0FBdkI7cUJBQ0EsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBbkIsQ0FBdUIsT0FBdkIsRUFISjs7VUFENkIsQ0FBakM7VUFLQSxJQUFHLFFBQVEsQ0FBQyxLQUFaO21CQUNJLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFFBQVEsQ0FBQyxLQUF6QixFQUFnQyxTQUFDLFdBQUQ7cUJBQzVCLFdBQUEsQ0FBWSxXQUFaO1lBRDRCLENBQWhDLEVBREo7O1FBUFU7ZUFXZCxPQUFPLENBQUMsT0FBUixDQUFnQixNQUFNLENBQUMsVUFBdkIsRUFBbUMsU0FBQyxRQUFEO2lCQUMvQixXQUFBLENBQVksUUFBWjtRQUQrQixDQUFuQztNQVpVO01BZWQsSUFBRyxRQUFRLENBQUMsV0FBWjtRQUNJLE1BQUEsR0FBUyxJQUFJLENBQUMsS0FBTCxDQUFXLFFBQVEsQ0FBQyxXQUFwQixDQUFpQyxDQUFBLENBQUE7UUFDMUMsVUFBQSxHQUFhLENBQ1QsSUFEUyxFQUVULE1BRlMsRUFHVCxPQUhTLEVBSVQsV0FKUztRQU9iLElBQUcsTUFBSDtVQUNJLElBQUcsQ0FBQyxPQUFPLENBQUMsTUFBUixDQUFlLE1BQU0sQ0FBQyxtQkFBUCxDQUEyQixNQUEzQixDQUFmLEVBQW1ELFVBQW5ELENBQUo7WUFDSSxRQUFRLENBQUMsV0FBVCxHQUF1QixJQUFJLENBQUMsU0FBTCxDQUFlLEVBQWYsRUFEM0I7V0FESjtTQVRKOztNQWFBLFVBQVUsQ0FBQyxNQUFYLENBQWtCLGVBQWxCLEVBQW1DLENBQUMsU0FBQyxLQUFEO0FBQ2hDLFlBQUE7UUFBQSxHQUFBLEdBQU07UUFDTixPQUFPLENBQUMsT0FBUixDQUFnQixLQUFoQixFQUF1QixTQUFDLENBQUQ7VUFDbkIsSUFBRyxDQUFDLENBQUMsS0FBRixHQUFVLENBQWI7bUJBQ0ksR0FBRyxDQUFDLElBQUosQ0FDSTtjQUFBLEVBQUEsRUFBSSxDQUFDLENBQUMsU0FBRixJQUFlLENBQUMsQ0FBQyxFQUFyQjtjQUNBLElBQUEsRUFBTSxDQUFDLENBQUMsSUFEUjtjQUVBLEtBQUEsRUFBTyxDQUFDLENBQUMsS0FGVDtjQUdBLFNBQUEsRUFBVyxDQUFDLENBQUMsU0FIYjthQURKLEVBREo7O1FBRG1CLENBQXZCO2VBUUEsUUFBUSxDQUFDLFdBQVQsR0FBdUIsSUFBSSxDQUFDLFNBQUwsQ0FBZSxHQUFmO01BVlMsQ0FBRCxDQUFuQyxFQVdHLElBWEg7TUFhQSxVQUFVLENBQUMsS0FBWCxHQUFtQixTQUFBO1FBQ2YsSUFBRyxLQUFLLENBQUMsVUFBTixJQUFxQixLQUFLLENBQUMsUUFBOUI7aUJBQ0ksS0FESjtTQUFBLE1BQUE7aUJBR0ksTUFISjs7TUFEZTtNQU1uQixVQUFVLENBQUMsUUFBWCxHQUFzQjtNQUN0QixVQUFVLENBQUMsVUFBWCxHQUF3QjtNQUN4QixVQUFVLENBQUMsRUFBRSxDQUFDLElBQWQsR0FDSTtRQUFBLEtBQUEsRUFBTyxpQkFBUDtRQUNBLFdBQUEsRUFBYSxXQURiO1FBRUEsU0FBQSxFQUFXLFFBRlg7UUFHQSxTQUFBLEVBQVcsS0FIWDtRQUlBLE9BQUEsRUFBUyxPQUpUO1FBS0EsTUFBQSxFQUFRLEtBTFI7UUFNQSxLQUFBLEVBQVUsUUFBUSxDQUFDLFdBQVosR0FBNkIsSUFBSSxDQUFDLEtBQUwsQ0FBVyxRQUFRLENBQUMsV0FBcEIsQ0FBN0IsR0FBbUUsRUFOMUU7UUFPQSxNQUFBLEVBQVEsU0FBQyxLQUFEO0FBQ0osY0FBQTtVQUFBLENBQUEsR0FBSTtVQUNKLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQW5DLEVBQTBDLFNBQUMsSUFBRDtZQUN0QyxJQUFHLElBQUksQ0FBQyxLQUFMLEdBQWEsQ0FBYixJQUFtQixDQUFDLEtBQXZCO2NBQ0ksQ0FBQSxHQURKO2FBQUEsTUFFSyxJQUFHLEtBQUg7Y0FDRCxDQUFBLElBQUssSUFBSSxDQUFDLE1BRFQ7O1VBSGlDLENBQTFDO2lCQU1BO1FBUkksQ0FQUjtRQWdCQSxLQUFBLEVBQU8sU0FBQyxJQUFEO0FBQ0gsY0FBQTtVQUFBLEtBQUEsR0FBUSxRQUFBLENBQVMsSUFBSSxDQUFDLEtBQWQ7VUFDUixJQUFHLEtBQUEsR0FBUSxJQUFYO1lBQ0ksS0FBQSxHQUFRLEtBRFo7V0FBQSxNQUVLLElBQUcsS0FBQSxHQUFRLENBQVg7WUFDRCxLQUFBLEdBQVEsRUFEUDtXQUFBLE1BRUEsSUFBRyxDQUFDLFFBQVEsQ0FBQyxJQUFULENBQWMsS0FBZCxDQUFKO1lBQ0QsS0FBQSxHQUFRLEVBRFA7O1VBRUwsSUFBSSxDQUFDLEtBQUwsR0FBYTtRQVJWLENBaEJQO1FBMEJBLEtBQUEsRUFBTyxTQUFBO1VBQ0gsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBbkMsRUFBMEMsU0FBQyxJQUFEO1lBQ3RDLElBQUksQ0FBQyxLQUFMLEdBQWE7VUFEeUIsQ0FBMUM7UUFERyxDQTFCUDtRQStCQSxHQUFBLEVBQUssU0FBQyxJQUFEO0FBQ0QsY0FBQTtVQUFBLEtBQUEsR0FBUTtVQUNSLEtBQUEsR0FBUTtVQUNSLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQW5DLEVBQTBDLFNBQUMsQ0FBRCxFQUFJLEVBQUo7WUFDdEMsSUFBRyxDQUFDLENBQUMsSUFBRixLQUFVLElBQUksQ0FBQyxJQUFsQjtjQUNJLEtBQUEsR0FBUTtjQUNSLEtBQUEsR0FBUSxHQUZaOztVQURzQyxDQUExQztVQUtBLElBQUcsS0FBSDttQkFBYyxNQUFkO1dBQUEsTUFBQTttQkFBeUIsTUFBekI7O1FBUkMsQ0EvQkw7UUF3Q0EsTUFBQSxFQUFRLFNBQUMsSUFBRDtVQUNKLElBQUksQ0FBQyxLQUFMLEdBQWE7UUFEVCxDQXhDUjtRQTJDQSxHQUFBLEVBQUssU0FBQyxJQUFEO0FBQ0QsY0FBQTtVQUFBLEtBQUEsR0FBUTtVQUNSLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQW5DLEVBQTBDLFNBQUMsQ0FBRDtZQUN0QyxJQUFHLENBQUMsQ0FBQyxJQUFGLEtBQVUsSUFBSSxDQUFDLElBQWxCO2NBQ0ksS0FBQSxHQUFRLEtBRFo7O1VBRHNDLENBQTFDO1VBSUEsSUFBRyxDQUFDLEtBQUo7WUFDSSxJQUFJLENBQUMsS0FBTCxHQUFhO1lBQ2IsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQXpCLENBQThCLElBQTlCLEVBRko7O1FBTkMsQ0EzQ0w7UUFxREEsS0FBQSxFQUFPLFNBQUE7QUFDSCxjQUFBO1VBQUEsS0FBQSxHQUFRO1VBQ1IsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBbkMsRUFBMEMsU0FBQyxJQUFEO1lBQ3RDLEtBQUEsSUFBUyxJQUFJLENBQUMsU0FBTCxHQUFpQixJQUFJLENBQUM7VUFETyxDQUExQztpQkFHQTtRQUxHLENBckRQO1FBMkRBLE1BQUEsRUFBUSxTQUFBO1VBQ0osSUFBRyxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBOUIsS0FBcUMsU0FBeEM7WUFDSSxRQUFRLENBQUMsaUJBQVQsR0FBNkI7WUFDN0IsUUFBQSxDQUFTLFNBQUE7Y0FDTCxRQUFRLENBQUMsSUFBVCxHQUFnQixVQUFVLENBQUMsTUFBTSxDQUFDLFFBQWxCLEdBQTZCO1lBRHhDLENBQVQsRUFGSjtXQUFBLE1BQUE7WUFNSSxVQUFVLENBQUMsVUFBVSxDQUFDLE1BQXRCLENBQUEsRUFOSjs7UUFESSxDQTNEUjtRQW9FQSxNQUFBLEVBQVEsU0FBQTtVQUNKLFFBQVEsQ0FBQyxPQUFULENBQWlCLGtDQUFqQixFQUFxRCxTQUFBO1lBQ2pELFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQW5CLENBQUE7WUFDQSxPQUFPLFFBQVEsQ0FBQztVQUZpQyxDQUFyRDtRQURJLENBcEVSOztNQTJFSixVQUFVLENBQUMsSUFBWCxDQUNJO1FBQUEsTUFBQSxFQUFRLFVBQVI7UUFDQSxNQUFBLEVBQVEsUUFEUjtRQUVBLE1BQUEsRUFBUSxjQUZSO09BREosQ0FJQSxDQUFDLElBSkQsQ0FJTSxTQUFDLENBQUQ7UUFDRixJQUFHLENBQUMsQ0FBQyxRQUFMO1VBQ0ksVUFBVSxDQUFDLFVBQVgsR0FBd0IsQ0FBQyxDQUFDO1VBQzFCLEtBQUssQ0FBQyxVQUFOLEdBQW1CO1VBQ25CLElBQUcsVUFBVSxDQUFDLEtBQWQ7bUJBQ0ksV0FBQSxDQUFBLEVBREo7V0FISjs7TUFERSxDQUpOO01BV0EsVUFBVSxDQUFDLElBQVgsQ0FDSTtRQUFBLE1BQUEsRUFBUSxTQUFSO1FBQ0EsTUFBQSxFQUFRLEtBRFI7T0FESixDQUdBLENBQUMsSUFIRCxDQUdNLFNBQUMsQ0FBRDtRQUNGLElBQUcsQ0FBQyxDQUFDLFFBQUw7VUFDSSxNQUFNLENBQUMsUUFBUCxHQUFrQixDQUFDLENBQUM7VUFDcEIsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsQ0FBQyxDQUFDLFFBQWxCLEVBQTRCLFNBQUMsSUFBRDttQkFDeEIsSUFBSSxDQUFDLE9BQUwsR0FBZSxVQUFVLENBQUMsTUFBTSxDQUFDLFVBQWxCLEdBQStCLElBQUksQ0FBQztVQUQzQixDQUE1QjtVQUdBLEtBQUssQ0FBQyxRQUFOLEdBQWlCO1VBQ2pCLElBQUcsVUFBVSxDQUFDLEtBQWQ7bUJBQ0ksV0FBQSxDQUFBLEVBREo7V0FOSjs7TUFERSxDQUhOO2FBYUEsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsTUFBaEIsQ0FBdUIsQ0FBQyxFQUF4QixDQUNJO1FBQUEsU0FBQSxFQUFXLFNBQUMsQ0FBRDtBQUNQLGNBQUE7VUFBQSxNQUFBLEdBQVMsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsQ0FBQyxDQUFDLE1BQWxCO1VBQ1QsSUFBRyxNQUFNLENBQUMsT0FBUCxDQUFlLE9BQWYsQ0FBdUIsQ0FBQyxNQUF4QixLQUFrQyxDQUFsQyxJQUF3QyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUExRDttQkFDSSxPQUFPLENBQUMsT0FBUixDQUFnQixXQUFoQixDQUE0QixDQUFDLE9BQTdCLENBQXFDLE9BQXJDLEVBREo7O1FBRk8sQ0FBWDtPQURKO0lBM0pELENBQUEsQ0FBSCxDQUFBO0VBNUQ2QyxDQUFqRDtBQURBIiwiZmlsZSI6ImNsaWVudC9sYXllcnMvd2Vic2l0ZS90ZW1wbGF0ZXMvY3JhYi9qcy9jb250cm9sbGVycy9tYWluQ3RybC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xuYW5ndWxhci5tb2R1bGUoJ21haW5BcHAnKS5jb250cm9sbGVyICdtYWluQ3RybCcsICgkcm9vdFNjb3BlLCAkc2NvcGUsICRnclJlc3RmdWwsICRnckFsZXJ0LCAkZ3JNb2RhbCwgJGNvb2tpZXMsICR0aW1lb3V0KSAtPlxuXG4gICAgJHJvb3RTY29wZS5HUklGRk8uY3VyWWVhciA9IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKVxuXG4gICAgaWYgJHJvb3RTY29wZS5HUklGRk8uZmlsdGVyLnBhZ2UuYmxvY2tzXG4gICAgICAgICRyb290U2NvcGUuQkxPQ0tTID0ge31cbiAgICAgICAgYW5ndWxhci5mb3JFYWNoICRyb290U2NvcGUuR1JJRkZPLmZpbHRlci5wYWdlLmJsb2NrcywgKGJsb2NrKSAtPlxuICAgICAgICAgICAgJHJvb3RTY29wZS5CTE9DS1NbYmxvY2submFtZV0gPSBibG9jay5jb250ZW50XG5cblxuICAgIGFsZXJ0ID0gJGdyQWxlcnQubmV3KClcbiAgICAkcm9vdFNjb3BlLmxvZ291dGluZyA9IGZhbHNlXG4gICAgJHJvb3RTY29wZS5nciA9IHt9XG4gICAgJHJvb3RTY29wZS5nci53ZWJzaXRlID0gY29weXJpZ2h0OiAnQ29weXJpZ2h0IMKpICcgKyAobmV3IERhdGUpLmdldEZ1bGxZZWFyKCkgKyAnIC0gVG9kb3Mgb3MgZGlyZWl0b3MgcmVzZXJ2YWRvcy4nXG4gICAgJHJvb3RTY29wZS5nci5jb250YWN0SGVhZGVyID0gW1xuICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0ZhY2Vib29rIEFjb2xsJ1xuICAgICAgICAgICAgbGluazogJ2h0dHA6Ly9mYi5jb20vZmFuLmFjb2xsJ1xuICAgICAgICAgICAgY2xhc3M6ICdjb250YWN0IGZhIGZhLWZ3IGZhLTJ4IGZhLWZhY2Vib29rLXNxdWFyZSdcbiAgICAgICAgfVxuICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0UtbWFpbCBBY29sbCdcbiAgICAgICAgICAgIGxpbms6ICdtYWlsdG86Y29udGF0b0BhY29sbC5jb20uYnInXG4gICAgICAgICAgICBjbGFzczogJ2NvbnRhY3QgZmEgZmEtZncgZmEtMnggZmEtZW52ZWxvcGUnXG4gICAgICAgIH1cbiAgICBdXG4gICAgJHJvb3RTY29wZS5nci5zaG9wcyA9IFtdXG4gICAgJHJvb3RTY29wZS5nci5iYW5uZXJzID0gW11cblxuICAgICRnclJlc3RmdWwuZmluZChcbiAgICAgICAgbW9kdWxlOiAnYmFubmVyJ1xuICAgICAgICBhY3Rpb246ICdnZXQnXG4gICAgKS50aGVuIChyKSAtPlxuICAgICAgICBpZiByLnJlc3BvbnNlXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmdyLmJhbm5lcnMgPSByLnJlc3BvbnNlXG5cbiAgICAkZ3JSZXN0ZnVsLmZpbmQoXG4gICAgICAgIG1vZHVsZTogJ3Nob3AnXG4gICAgICAgIGFjdGlvbjogJ2dldCdcbiAgICApLnRoZW4gKHIpIC0+XG4gICAgICAgIGlmIHIucmVzcG9uc2VcbiAgICAgICAgICAgICRyb290U2NvcGUuZ3Iuc2hvcHMgPSByLnJlc3BvbnNlXG5cbiAgICAkcm9vdFNjb3BlLmxvZ291dCA9IC0+XG4gICAgICAgIGFsZXJ0LnNob3cgJ2xvYWRpbmcnLCAnU2FpbmRvLi4uJywgMFxuICAgICAgICAkcm9vdFNjb3BlLmxvZ291dGluZyA9IHRydWVcbiAgICAgICAgJGdyUmVzdGZ1bC5hdXRoXG4gICAgICAgICAgICBhY3Rpb246ICdsb2dvdXQnXG4gICAgICAgIC50aGVuIChyKSAtPlxuICAgICAgICAgICAgZGVsZXRlICRjb29raWVzLmdyaWZmb19jYXJ0X3JlYWR5XG4gICAgICAgICAgICBpZiByLnJlc3BvbnNlXG4gICAgICAgICAgICAgICAgYWxlcnQuc2hvdyAnc3VjY2VzcycsICdWb2PDqiBzYWl1IGRvIHNpc3RlbWEgZSBlc3TDoSBzZW5kbyByZWRpcmVjaW9uYWRvISdcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKClcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnICdGYWxoYSBubyBsb2dvdXQhJ1xuICAgICAgICAgICAgJHJvb3RTY29wZS5sb2dvdXRpbmcgPSBmYWxzZVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICwgKHIpIC0+XG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnICdGYWxoYSBubyBsb2dvdXQhJ1xuXG4gICAgZG8gLT5cbiAgICAgICAgaW5pdCA9IHRydWVcbiAgICAgICAgcmVhZHkgPVxuICAgICAgICAgICAgY2F0ZWdvcmllczogZmFsc2VcbiAgICAgICAgICAgIHByb2R1Y3RzOiBmYWxzZVxuXG4gICAgICAgIHNldFByb2R1Y3RzID0gLT5cbiAgICAgICAgICAgIHByb2R1Y3RMb29wID0gKGNhdGVnb3J5KSAtPlxuICAgICAgICAgICAgICAgIGNhdGVnb3J5LnByb2R1Y3RzID0gW11cbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2ggJHNjb3BlLnByb2R1Y3RzLCAocHJvZHVjdCkgLT5cbiAgICAgICAgICAgICAgICAgICAgaWYgcHJvZHVjdC5ma2lkY2F0ZWdvcnkgPT0gY2F0ZWdvcnkuaWRjYXRlZ29yeVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5jb3VudCA9IDBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5LnByb2R1Y3RzLnB1c2ggcHJvZHVjdFxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5nci5jYXJ0LmFkZCBwcm9kdWN0XG4gICAgICAgICAgICAgICAgaWYgY2F0ZWdvcnkuY2hpbGRcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoIGNhdGVnb3J5LmNoaWxkLCAoc3ViY2F0ZWdvcnkpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TG9vcCBzdWJjYXRlZ29yeVxuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2ggJHNjb3BlLmNhdGVnb3JpZXMsIChjYXRlZ29yeSkgLT5cbiAgICAgICAgICAgICAgICBwcm9kdWN0TG9vcCBjYXRlZ29yeVxuXG4gICAgICAgIGlmICRjb29raWVzLmdyaWZmb19jYXJ0XG4gICAgICAgICAgICBzdHJ1Y3QgPSBKU09OLnBhcnNlKCRjb29raWVzLmdyaWZmb19jYXJ0KVswXVxuICAgICAgICAgICAgcHJvcGVydGllcyA9IFtcbiAgICAgICAgICAgICAgICAnaWQnXG4gICAgICAgICAgICAgICAgJ25hbWUnXG4gICAgICAgICAgICAgICAgJ2NvdW50J1xuICAgICAgICAgICAgICAgICd1bml0dmFsdWUnXG4gICAgICAgICAgICBdXG5cbiAgICAgICAgICAgIGlmIHN0cnVjdFxuICAgICAgICAgICAgICAgIGlmICFhbmd1bGFyLmVxdWFscyhPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhzdHJ1Y3QpLCBwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAkY29va2llcy5ncmlmZm9fY2FydCA9IEpTT04uc3RyaW5naWZ5KFtdKVxuXG4gICAgICAgICRyb290U2NvcGUuJHdhdGNoICdnci5jYXJ0Lml0ZW1zJywgKChpdGVtcykgLT5cbiAgICAgICAgICAgIGFyciA9IFtdXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2ggaXRlbXMsIChpKSAtPlxuICAgICAgICAgICAgICAgIGlmIGkuY291bnQgPiAwXG4gICAgICAgICAgICAgICAgICAgIGFyci5wdXNoXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogaS5pZHByb2R1Y3Qgb3IgaS5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogaS5jb3VudFxuICAgICAgICAgICAgICAgICAgICAgICAgdW5pdHZhbHVlOiBpLnVuaXR2YWx1ZVxuXG4gICAgICAgICAgICAkY29va2llcy5ncmlmZm9fY2FydCA9IEpTT04uc3RyaW5naWZ5KGFycilcbiAgICAgICAgKSwgdHJ1ZVxuXG4gICAgICAgICRyb290U2NvcGUucmVhZHkgPSAtPlxuICAgICAgICAgICAgaWYgcmVhZHkuY2F0ZWdvcmllcyBhbmQgcmVhZHkucHJvZHVjdHNcbiAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgZmFsc2VcblxuICAgICAgICAkcm9vdFNjb3BlLnByb2R1Y3RzID0gW11cbiAgICAgICAgJHJvb3RTY29wZS5jYXRlZ29yaWVzID0gW11cbiAgICAgICAgJHJvb3RTY29wZS5nci5jYXJ0ID1cbiAgICAgICAgICAgIHRpdGxlOiAnTGlzdGEgZG8gcGVkaWRvJ1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjYXJ0Lmh0bWwnXG4gICAgICAgICAgICBwbGFjZW1lbnQ6ICdib3R0b20nXG4gICAgICAgICAgICBhbmltYXRpb246IGZhbHNlXG4gICAgICAgICAgICB0cmlnZ2VyOiAnY2xpY2snXG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgICAgICBpdGVtczogaWYgJGNvb2tpZXMuZ3JpZmZvX2NhcnQgdGhlbiBKU09OLnBhcnNlKCRjb29raWVzLmdyaWZmb19jYXJ0KSBlbHNlIFtdXG4gICAgICAgICAgICBsZW5ndGg6ICh0b3RhbCkgLT5cbiAgICAgICAgICAgICAgICBsID0gMFxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCAkcm9vdFNjb3BlLmdyLmNhcnQuaXRlbXMsIChpdGVtKSAtPlxuICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLmNvdW50ID4gMCBhbmQgIXRvdGFsXG4gICAgICAgICAgICAgICAgICAgICAgICBsKytcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiB0b3RhbFxuICAgICAgICAgICAgICAgICAgICAgICAgbCArPSBpdGVtLmNvdW50XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIGxcbiAgICAgICAgICAgIGNoZWNrOiAoaXRlbSkgLT5cbiAgICAgICAgICAgICAgICBjb3VudCA9IHBhcnNlSW50KGl0ZW0uY291bnQpXG4gICAgICAgICAgICAgICAgaWYgY291bnQgPiAxMDAwXG4gICAgICAgICAgICAgICAgICAgIGNvdW50ID0gMTAwMFxuICAgICAgICAgICAgICAgIGVsc2UgaWYgY291bnQgPCAwXG4gICAgICAgICAgICAgICAgICAgIGNvdW50ID0gMFxuICAgICAgICAgICAgICAgIGVsc2UgaWYgIS9bMC05XSsvLnRlc3QoY291bnQpXG4gICAgICAgICAgICAgICAgICAgIGNvdW50ID0gMFxuICAgICAgICAgICAgICAgIGl0ZW0uY291bnQgPSBjb3VudFxuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgY2xlYXI6IC0+XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoICRyb290U2NvcGUuZ3IuY2FydC5pdGVtcywgKGl0ZW0pIC0+XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY291bnQgPSAwXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgaGFzOiAoaXRlbSkgLT5cbiAgICAgICAgICAgICAgICBmb3VuZCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgaW5kZXggPSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2ggJHJvb3RTY29wZS5nci5jYXJ0Lml0ZW1zLCAoaSwgaWQpIC0+XG4gICAgICAgICAgICAgICAgICAgIGlmIGkubmFtZSA9PSBpdGVtLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpZFxuICAgICAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICBpZiBmb3VuZCB0aGVuIGluZGV4IGVsc2UgZm91bmRcbiAgICAgICAgICAgIHJlbW92ZTogKGl0ZW0pIC0+XG4gICAgICAgICAgICAgICAgaXRlbS5jb3VudCA9IDBcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIGFkZDogKGl0ZW0pIC0+XG4gICAgICAgICAgICAgICAgZm91bmQgPSBmYWxzZVxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCAkcm9vdFNjb3BlLmdyLmNhcnQuaXRlbXMsIChpKSAtPlxuICAgICAgICAgICAgICAgICAgICBpZiBpLm5hbWUgPT0gaXRlbS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgaWYgIWZvdW5kXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY291bnQgPSAwXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuZ3IuY2FydC5pdGVtcy5wdXNoIGl0ZW1cbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIHRvdGFsOiAtPlxuICAgICAgICAgICAgICAgIHRvdGFsID0gMFxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCAkcm9vdFNjb3BlLmdyLmNhcnQuaXRlbXMsIChpdGVtKSAtPlxuICAgICAgICAgICAgICAgICAgICB0b3RhbCArPSBpdGVtLnVuaXR2YWx1ZSAqIGl0ZW0uY291bnRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgdG90YWxcbiAgICAgICAgICAgIHN1Ym1pdDogLT5cbiAgICAgICAgICAgICAgICBpZiAkcm9vdFNjb3BlLkdSSUZGTy5maWx0ZXIucGFnZS51cmwgIT0gJ2ZpbmlzaC8nXG4gICAgICAgICAgICAgICAgICAgICRjb29raWVzLmdyaWZmb19jYXJ0X3JlYWR5ID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dCAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9ICRyb290U2NvcGUuR1JJRkZPLmN1ckFsaWFzICsgJy9maW5pc2gnXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuZmluaXNoRm9ybS5zdWJtaXQoKVxuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgY2FuY2VsOiAtPlxuICAgICAgICAgICAgICAgICRnck1vZGFsLmNvbmZpcm0gJ1RlbSBjZXJ0ZXphIHF1ZSBkZXNlamEgY2FuY2VsYXI/JywgLT5cbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5nci5jYXJ0LmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRjb29raWVzLmdyaWZmb19jYXJ0X3JlYWR5XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIHJldHVyblxuXG4gICAgICAgICRnclJlc3RmdWwuZmluZFxuICAgICAgICAgICAgbW9kdWxlOiAnY2F0ZWdvcnknXG4gICAgICAgICAgICBhY3Rpb246ICdtb2R1bGUnXG4gICAgICAgICAgICBwYXJhbXM6ICduYW1lPXByb2R1Y3QnXG4gICAgICAgIC50aGVuIChyKSAtPlxuICAgICAgICAgICAgaWYgci5yZXNwb25zZVxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuY2F0ZWdvcmllcyA9IHIucmVzcG9uc2VcbiAgICAgICAgICAgICAgICByZWFkeS5jYXRlZ29yaWVzID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGlmICRyb290U2NvcGUucmVhZHlcbiAgICAgICAgICAgICAgICAgICAgc2V0UHJvZHVjdHMoKVxuXG4gICAgICAgICRnclJlc3RmdWwuZmluZFxuICAgICAgICAgICAgbW9kdWxlOiAncHJvZHVjdCdcbiAgICAgICAgICAgIGFjdGlvbjogJ2dldCdcbiAgICAgICAgLnRoZW4gKHIpIC0+XG4gICAgICAgICAgICBpZiByLnJlc3BvbnNlXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2R1Y3RzID0gci5yZXNwb25zZVxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCByLnJlc3BvbnNlLCAoaXRlbSkgLT5cbiAgICAgICAgICAgICAgICAgICAgaXRlbS5waWN0dXJlID0gJHJvb3RTY29wZS5HUklGRk8udXBsb2FkUGF0aCArIGl0ZW0ucGljdHVyZVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZWFkeS5wcm9kdWN0cyA9IHRydWVcbiAgICAgICAgICAgICAgICBpZiAkcm9vdFNjb3BlLnJlYWR5XG4gICAgICAgICAgICAgICAgICAgIHNldFByb2R1Y3RzKClcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJ2JvZHknKS5vblxuICAgICAgICAgICAgbW91c2Vkb3duOiAoZSkgLT5cbiAgICAgICAgICAgICAgICB0YXJnZXQgPSBhbmd1bGFyLmVsZW1lbnQoZS50YXJnZXQpXG4gICAgICAgICAgICAgICAgaWYgdGFyZ2V0LnBhcmVudHMoJy5jYXJ0JykubGVuZ3RoID09IDAgYW5kICRzY29wZS5nci5jYXJ0Lm9wZW5lZFxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJy5idG4tY2FydCcpLnRyaWdnZXIgJ2NsaWNrJ1xuIl19